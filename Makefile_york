##########################################################################
# Makefile for CCP4 library                                              #
##########################################################################
#
#
# Aliant stuff from Kim - Feb 13 1992
#SRC        = /public/xtal/ccp4
#FCOMP      = fortran
#FFLAGS     = -c -save -Og -ieee -uniproc
#RANLIB     = ranlib
#SHELL      = /bin/sh
#CCOMP      = fxc 
#CFLAGS     = -Og -c -lcurses -ltermcap -uniproc
#BIN        = /public/xtal/bin
#LIB        = ${SRC}/lib
#
#   Iris stuff-york
SRC        = /y/programs/ccp4/xtal/ccp4
FCOMP      = f77
FFLAGS     = -c -O2 -static -vms_cc
RANLIB     = ranlib
SHELL      = /bin/sh
# Following line is used on SGI for ANSI compiling
CCOMP1     = cc  -O2 -acpp -prototypes -DFUNCPROTO -DPOSIX -Dsgi
CCOMP      = cc
CFLAGS     = -O2
BIN        = /y/programs/ccp4/xtal/bin
LIB        = ${SRC}/lib


# FLOOP is the main loop procedure for compiling fortran modules
#
# $?  for the list of prerequisites that are out of date
# $@ for the full target name
# $* stands for the target name with suffix deleted
# $< for the complete list of prerequisites
#

FLOOP=		-@for i in $?; 					\
			do		 			\
				/bin/rm -f *.f *.o;		\
				echo Using fsplit on $$i; 	\
				fsplit $$i; 			\
				echo compiling $$i; 		\
				${FCOMP} ${FFLAGS} *.f; 	\
				touch $@; 			\
				/bin/rm -f zzz00?.o; 		\
				ar r ${LIB}/libccp4.a *.o ;	\
				/bin/rm -f *.o *.f ;		\
				echo Make done on $$i; 		\
		done



FTARGETS =		diskio.for    ccplib.for  fftlib.for  maplib.for\
			parser.for    rwatom.for  rwbrook.for mtzlib.for\
			modlib.for    symlib.for  lcflib.for  graflib.for\
			plot84lib.for unix.for    hlplib.for

CTARGETS   = 		library.c binsortint.c ucurse.c


help:
	@echo "Use: make libs    - to make library ccplibs.a"
	@echo "     make sort    - to make binsort"
	@echo "     make all     - to make libs and sort"
	@echo "     make clean   - to tidy directory and leave as new"

clean:
	-rm -f *.f *.o 

all:		libs sort

libs:		libs_f libs_c 

libs_f:		${FTARGETS}
		@${FLOOP}

libs_c:		${CTARGETS}
		@echo Making library C routines
		-@rm -f *.o
		${CCOMP}  -c ${CFLAGS} $?
		ar r ${LIB}/libccp4.a *.o
		-@rm -f *.o *.f
		@touch libs_c
		@echo Make done on library_c


sort:		binsort
		mv binsort ${BIN}/.
		/bin/rm -f binsort.o
		@touch sort
		@echo Make done on binsort

binsort:	binsort.o
		cc -O2  binsort.o -o binsort

binsort.o:	binsort.c binsort.h
		cc -c -ansi -O2  binsort.c

